"use strict";(globalThis.webpackChunk=globalThis.webpackChunk||[]).push([["app_components_notifications_notification-shelf-watcher-element_ts"],{55859:(t,e,r)=>{r.d(e,{d:()=>l,t:()=>o});var i=r(69653);let n=["notification_referrer_id","notifications_before","notifications_after","notifications_query"],a="notification_shelf";function o(t,e=null){return t.has("notification_referrer_id")?(function(t,e){let r=c(e);if(!r)return;let o={pathname:r};for(let e of n){let r=t.get(e);r&&(o[e]=r)}(0,i.SO)(a,JSON.stringify(o))}(t,e),function(t){for(let e of n)t.delete(e);return t}(t)):null}function l(t=null){let e=c(t);if(!e)return(0,i.Ai)(a),null;try{let t=(0,i.Gq)(a);if(!t)return null;let r=JSON.parse(t);if(!r||!r.pathname)throw Error("Must have a pathname");if(r.pathname!==e)throw Error("Stored pathname does not match current pathname.");let o={};for(let t of n)o[t]=r[t];return o}catch(t){return(0,i.Ai)(a),null}}function c(t){let e=(t=t||window.location.pathname).match(/^(\/[^/]+\/[^/]+\/pull\/[^/]+)/);return e?e[0]:null}},31960:(t,e,r)=>{r.r(e),r.d(e,{NotificationShelfWatcherElement:()=>NotificationShelfWatcherElement});var i=r(39595),n=r(18292),a=r(55859);function o(t,e,r,i){var n,a=arguments.length,o=a<3?e:null===i?i=Object.getOwnPropertyDescriptor(e,r):i;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)o=Reflect.decorate(t,e,r,i);else for(var l=t.length-1;l>=0;l--)(n=t[l])&&(o=(a<3?n(o):a>3?n(e,r,o):n(e,r))||o);return a>3&&o&&Object.defineProperty(e,r,o),o}let NotificationShelfWatcherElement=class NotificationShelfWatcherElement extends HTMLElement{connectedCallback(){this.preload(),this.update(),this.addEventListener("socket:message",this.update.bind(this))}preload(){this.src=this.preloadSrc()}preloadSrc(){let t=this.getAttribute("src");if(t&&""!==t){let e=this.ownerDocument.createElement("a");return e.href=t,e.href}if(!this.baseUrl)return"";let e=(0,a.d)();if(!e)return"";let r=new URL(this.baseUrl,window.location.origin),i=new URLSearchParams(r.search);for(let[t,r]of Object.entries(e))"string"==typeof r&&i.set(t,r);return r.search=i.toString(),r.toString()}async update(){if(this.timeout&&clearTimeout(this.timeout),!this.src||""===this.src)return;let t=this.placeholder();if(!t)return;let e=t.hasAttribute("data-initial");t.setAttribute("data-url",this.src),await (0,n.le)(t),e&&this.refresh()}placeholder(){return document.querySelector("[data-target='notification-shelf-watcher.placeholder']")}refresh(){let t=this.placeholder();t&&t.querySelector("[data-notification-status='unread']")&&(this.timeout=setTimeout(()=>this.update(),this.refreshDelay))}constructor(...t){super(...t),this.refreshDelay=500}};o([i.CF],NotificationShelfWatcherElement.prototype,"baseUrl",void 0),o([i.CF],NotificationShelfWatcherElement.prototype,"refreshDelay",void 0),NotificationShelfWatcherElement=o([i.p_],NotificationShelfWatcherElement)}}]);
//# sourceMappingURL=app_components_notifications_notification-shelf-watcher-element_ts-8a559e4d759b.js.map